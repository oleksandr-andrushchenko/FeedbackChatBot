<?xml version="1.0" encoding="UTF-8" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <service id="app.telegram_feedback_search_post_factory"
                 class="App\Service\Telegram\TelegramFeedbackSearchPostFactory" lazy="true"/>
        <service id="app.telegram_client_factory" class="App\Service\Telegram\TelegramClientFactory" lazy="true"/>
        <service id="app.telegram_channel_factory" class="App\Service\Telegram\TelegramChannelFactory">
            <argument type="tagged_locator" tag="app.telegram_channel" index-by="channel"/>
        </service>
        <service id="app.telegram_conversation_factory_default" class="App\Service\Telegram\TelegramConversationFactory"
                 lazy="true">
            <argument type="tagged_locator" tag="app.telegram_conversation_default"/>
        </service>
        <service id="app.telegram_conversation_factory_feedbacks"
                 class="App\Service\Telegram\TelegramConversationFactory" lazy="true">
            <argument type="tagged_locator" tag="app.telegram_conversation_feedbacks"/>
        </service>
        <service id="app.telegram_options_factory" class="App\Service\Telegram\TelegramOptionsFactory" lazy="true"/>
        <service id="app.feedback_telegram_options" class="App\Entity\Telegram\TelegramOptions">
            <factory service="app.telegram_options_factory" method="createTelegramOptions"/>
            <argument>%app.feedback_telegram_options%</argument>
        </service>
        <service id="app.telegram_factory" class="App\Service\Telegram\TelegramFactory" lazy="true">
            <argument>%app.telegram_options%</argument>
            <argument type="service" id="app.telegram_options_factory"/>
            <argument type="service" id="app.telegram_client_registry"/>
            <argument type="service" id="app.telegram_request_checker"/>
            <argument type="service" id="logger"/>
        </service>
        <service id="app.telegram_active_conversation_invoker"
                 class="App\Service\Telegram\TelegramActiveConversationInvoker" lazy="true">
            <argument type="service" id="app.telegram_conversation_manager"/>
        </service>
        <service id="app.telegram_conversation_manager" class="App\Service\Telegram\TelegramConversationManager"
                 lazy="true">
            <argument type="service" id="app.repository.telegram_conversation"/>
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="serializer"/>
            <argument type="service" id="serializer"/>
            <argument type="service" id="app.array_null_filter"/>
            <argument type="service" id="app.telegram_channel_registry"/>
            <argument type="service" id="app.telegram_chat_provider"/>
        </service>
        <service id="app.telegram_my_commands_provider" class="App\Service\Telegram\TelegramMyCommandsProvider"
                 lazy="true">
            <argument type="service" id="app.telegram_channel_registry"/>
        </service>
        <service id="app.telegram_webhook_updater" class="App\Service\Telegram\Api\TelegramWebhookUpdater" lazy="true"/>
        <service id="app.telegram_webhook_remover" class="App\Service\Telegram\Api\TelegramWebhookRemover" lazy="true"/>
        <service id="app.telegram_webhook_info_provider" class="App\Service\Telegram\Api\TelegramWebhookInfoProvider"
                 lazy="true"/>
        <service id="app.telegram_user_provider" class="App\Service\Telegram\TelegramUserProvider" lazy="true"/>
        <service id="app.telegram_chat_provider" class="App\Service\Telegram\TelegramChatProvider" lazy="true"/>
        <service id="app.telegram_messenger_user_upserter" class="App\Service\Telegram\TelegramMessengerUserUpserter">
            <argument type="service" id="app.telegram_user_provider"/>
            <argument type="service" id="app.messenger_user_upserter"/>
            <argument type="service" id="app.user_upserter"/>
        </service>
        <service id="app.telegram_update_checker" class="App\Service\Telegram\TelegramUpdateChecker"
                 lazy="true">
            <argument type="service" id="app.repository.telegram_update"/>
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="logger"/>
        </service>
        <service id="app.telegram_request_checker" class="App\Service\Telegram\TelegramRequestChecker"
                 lazy="true">
            <argument type="service" id="app.repository.telegram_request"/>
            <argument type="service" id="doctrine.orm.entity_manager"/>
        </service>
        <service id="app.telegram_non_admin_update_checker" class="App\Service\Telegram\TelegramNonAdminUpdateChecker"
                 lazy="true">
            <argument type="service" id="app.telegram_user_provider"/>
        </service>
        <service id="app.telegram_command_finder" class="App\Service\Telegram\TelegramCommandFinder" lazy="true"/>
        <service id="app.telegram_update_factory" class="App\Service\Telegram\TelegramUpdateFactory" lazy="true">
            <argument type="service" id="logger"/>
        </service>
        <service id="app.telegram_update_handler" class="App\Service\Telegram\TelegramUpdateHandler" lazy="true">
            <argument type="service" id="app.telegram_update_factory"/>
            <argument type="service" id="app.telegram_update_checker"/>
            <argument type="service" id="app.telegram_non_admin_update_checker"/>
            <argument type="service" id="app.telegram_conversation_manager"/>
            <argument type="service" id="app.telegram_messenger_user_upserter"/>
            <argument type="service" id="app.telegram_channel_registry"/>
            <argument type="service" id="app.telegram_command_finder"/>
            <argument type="service" id="app.telegram_payment_manager"/>
            <argument type="service" id="translation.locale_switcher"/>
            <argument type="service" id="logger"/>
        </service>
        <service id="app.telegram_template_renderer" class="App\Service\Telegram\TelegramTemplateRenderer" lazy="true">
            <argument type="service" id="twig"/>
        </service>
        <service id="app.telegram_keyboard_factory" class="App\Service\Telegram\TelegramKeyboardFactory" lazy="true"/>
        <service id="app.telegram_commands_updater" class="App\Service\Telegram\Api\TelegramCommandsUpdater"
                 lazy="true">
            <argument type="service" id="app.translator"/>
            <argument type="service" id="app.telegram_my_commands_provider"/>
        </service>
        <service id="app.telegram_commands_remover" class="App\Service\Telegram\Api\TelegramCommandsRemover"
                 lazy="true">
            <argument type="service" id="app.telegram_my_commands_provider"/>
        </service>
        <service id="app.telegram_descriptions_updater" class="App\Service\Telegram\Api\TelegramDescriptionsUpdater"
                 lazy="true">
            <argument>%app.stage%</argument>
            <argument type="service" id="app.translator"/>
        </service>
        <service id="app.telegram_message_sender" class="App\Service\Telegram\Api\TelegramMessageSender" lazy="true"/>
        <service id="app.telegram_chat_action_sender" class="App\Service\Telegram\Api\TelegramChatActionSender"
                 lazy="true"/>
        <service id="app.telegram_client_registry" class="App\Service\Telegram\TelegramClientRegistry" lazy="true">
            <argument type="service" id="app.telegram_client_factory"/>
        </service>
        <service id="app.telegram_channel_registry" class="App\Service\Telegram\TelegramChannelRegistry" lazy="true">
            <argument type="service" id="app.telegram_channel_factory"/>
        </service>
        <service id="app.telegram_messenger_user_maker" class="App\Service\Telegram\TelegramMessengerUserMaker"
                 lazy="true"/>
        <service id="app.telegram_payment_method_provider"
                 class="App\Service\Telegram\Payment\TelegramPaymentMethodProvider" lazy="true">
            <argument>%app.telegram_payment_methods%</argument>
        </service>
        <service id="app.telegram_payment_manager" class="App\Service\Telegram\Payment\TelegramPaymentManager"
                 lazy="true">
            <argument type="service" id="app.telegram_invoice_sender"/>
            <argument type="service" id="app.telegram_payment_method_provider"/>
            <argument type="service" id="app.intl_currency_provider"/>
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="app.repository.telegram_payment"/>
            <argument type="service" id="app.uuid_generator"/>
        </service>
        <service id="app.telegram_registry" class="App\Service\Telegram\TelegramRegistry" lazy="true">
            <argument type="service" id="app.telegram_factory"/>
        </service>
        <service id="app.telegram_channel_default" class="App\Service\Telegram\Channel\DefaultTelegramChannel"
                 lazy="true">
            <argument type="service" id="app.telegram_aware_helper"/>
            <argument type="service" id="app.telegram_conversation_factory_default"/>
            <tag name="app.telegram_channel" channel="default"/>
        </service>
        <service id="app.telegram_channel_feedbacks" class="App\Service\Telegram\Channel\FeedbackTelegramChannel"
                 lazy="true">
            <argument type="service" id="app.telegram_aware_helper"/>
            <argument type="service" id="app.telegram_conversation_factory_feedbacks"/>
            <argument type="service" id="app.feedback_user_subscription_manager"/>
            <argument type="service" id="app.subscriptions_telegram_chat_sender"/>
            <argument type="service" id="app.hints_telegram_chat_switcher"/>
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <argument type="service" id="app.premium_describe_telegram_chat_sender"/>
            <argument type="service" id="app.start_telegram_command_handler"/>
            <tag name="app.telegram_channel" channel="feedbacks"/>
        </service>
        <service id="app.telegram_aware_helper" class="App\Service\Telegram\TelegramAwareHelper" lazy="true">
            <argument type="service" id="app.telegram_keyboard_factory"/>
            <argument type="service" id="app.telegram_message_sender"/>
            <argument type="service" id="app.translator"/>
            <argument type="service" id="app.telegram_conversation_manager"/>
            <argument type="service" id="app.telegram_template_renderer"/>
            <argument type="service" id="app.telegram_chat_action_sender"/>
            <argument type="service" id="app.telegram_chat_provider"/>
        </service>
        <service id="app.telegram_invoice_sender" class="App\Service\Telegram\Api\TelegramInvoiceSender" lazy="true"/>
        <service id="app.subscriptions_telegram_chat_sender"
                 class="App\Service\Telegram\Chat\SubscriptionsTelegramChatSender" lazy="true">
            <argument type="service" id="app.feedback_user_subscription_manager"/>
        </service>
        <service id="app.hints_telegram_chat_switcher"
                 class="App\Service\Telegram\Chat\HintsTelegramChatSwitcher" lazy="true"/>
        <service id="app.choose_action_telegram_chat_sender"
                 class="App\Service\Telegram\Chat\ChooseActionTelegramChatSender" lazy="true">
            <argument type="service" id="app.feedback_user_subscription_manager"/>
            <argument type="service" id="app.intl_country_provider"/>
        </service>
        <service id="app.premium_describe_telegram_chat_sender"
                 class="App\Service\Telegram\Chat\PremiumDescribeTelegramChatSender" lazy="true">
            <argument type="service" id="app.feedback_creator_options"/>
            <argument type="service" id="app.feedback_search_creator_options"/>
        </service>
        <service id="app.start_telegram_command_handler"
                 class="App\Service\Telegram\Chat\StartTelegramCommandHandler" lazy="true">
            <argument type="service" id="app.intl_country_provider"/>
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <argument type="service" id="app.site_url_generator"/>
        </service>
        <service id="app.telegram_conversation" class="App\Service\Telegram\Conversation\TelegramConversation"
                 abstract="true" lazy="true">
            <argument type="service" id="app.telegram_aware_helper"/>
        </service>
        <service id="app.telegram_conversation_choose_country" parent="app.telegram_conversation"
                 class="App\Service\Telegram\Conversation\ChooseFeedbackCountryTelegramConversation" lazy="true">
            <argument type="service" id="app.intl_country_provider"/>
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <tag name="app.telegram_conversation_feedbacks"/>
        </service>
        <service id="app.telegram_conversation_create_feedback" parent="app.telegram_conversation"
                 class="App\Service\Telegram\Conversation\CreateFeedbackTelegramConversation" lazy="true">
            <argument type="service" id="app.validator"/>
            <argument type="service" id="app.feedback_creator"/>
            <argument type="service" id="app.feedback_search_term_parser"/>
            <argument type="service" id="app.array_value_eraser"/>
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <tag name="app.telegram_conversation_feedbacks"/>
        </service>
        <service id="app.telegram_conversation_search_feedback" parent="app.telegram_conversation"
                 class="App\Service\Telegram\Conversation\SearchFeedbackTelegramConversation" lazy="true">
            <argument type="service" id="app.validator"/>
            <argument type="service" id="app.feedback_search_creator"/>
            <argument type="service" id="app.feedback_searcher"/>
            <argument type="service" id="app.feedback_search_term_parser"/>
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <tag name="app.telegram_conversation_feedbacks"/>
        </service>
        <service id="app.telegram_conversation_get_premium" parent="app.telegram_conversation"
                 class="App\Service\Telegram\Conversation\GetFeedbackPremiumTelegramConversation" lazy="true">
            <argument type="service" id="app.validator"/>
            <argument type="service" id="app.feedback_subscription_plan_provider"/>
            <argument type="service" id="app.telegram_payment_method_provider"/>
            <argument type="service" id="app.intl_country_provider"/>
            <argument type="service" id="app.intl_currency_provider"/>
            <argument type="service" id="app.telegram_payment_manager"/>
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <argument type="service" id="app.premium_describe_telegram_chat_sender"/>
            <tag name="app.telegram_conversation_feedbacks"/>
        </service>
        <service id="app.telegram_conversation_purge_account" parent="app.telegram_conversation"
                 class="App\Service\Telegram\Conversation\PurgeAccountConversationTelegramConversation" lazy="true">
            <argument type="service" id="app.user_data_purger"/>
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <tag name="app.telegram_conversation_feedbacks"/>
        </service>
        <service id="app.telegram_conversation_leave_feedback_message" parent="app.telegram_conversation"
                 class="App\Service\Telegram\Conversation\LeaveFeedbackMessageTelegramConversation" lazy="true">
            <argument type="service" id="app.user_feedback_message_creator"/>
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <tag name="app.telegram_conversation_feedbacks"/>
        </service>
        <service id="app.telegram_conversation_restart" parent="app.telegram_conversation"
                 class="App\Service\Telegram\Conversation\RestartConversationTelegramConversation" lazy="true">
            <argument type="service" id="app.choose_action_telegram_chat_sender"/>
            <argument type="service" id="app.start_telegram_command_handler"/>
            <tag name="app.telegram_conversation_feedbacks"/>
        </service>
    </services>
</container>